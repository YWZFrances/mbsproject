!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery||window.Zepto||window.$)}(function(t){var e=function(){var a,n,s,i,r,l;for(i=0,r=arguments.length;r>i;i++)e.isJquery(arguments[i])||e.isZepto(arguments[i])?a=arguments[i]:e.isElement(arguments[i])?a=t(arguments[i]):"function"==typeof arguments[i]?s=arguments[i]:"object"==typeof arguments[i]&&(n=arguments[i]);return l=new e.init(a,n),"function"==typeof s&&s(l),l};e.isElement=function(t){return!(!t||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(t instanceof HTMLElement))||!(!t||!t.nodeType||1!==t.nodeType)},e.isJquery=function(t){return!!(t&&t.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&t instanceof jQuery)},e.isZepto=function(t){return!(!t||!t.length||"function"!=typeof Zepto&&"object"!=typeof Zepto||!Zepto.zepto.isZ(t))},e.getIndex=function(t,e){return e?t:t-1},e.getData=function(t,e){if("string"==typeof e&&e.length){e=e.split(".");for(var a=0,n=e.length;n>a;a++)t=t[e[a]]}return t},e.init=function(a,n){var s,i,r=this;(e.isJquery(a)||e.isZepto(a))&&(s={dom:{box:a}},r.attach=e.attach.bind(s),r.detach=e.detach.bind(s),r.setOptions=e.setOptions.bind(s),r.clear=e.clear.bind(s),s.changeEvent=function(){e.selectChange.call(s,this.className)},s.settings=t.extend({},t.cxSelect.defaults,n,{url:s.dom.box.data("url"),emptyStyle:s.dom.box.data("emptyStyle"),required:s.dom.box.data("required"),firstTitle:s.dom.box.data("firstTitle"),firstValue:s.dom.box.data("firstValue"),jsonSpace:s.dom.box.data("jsonSpace"),jsonName:s.dom.box.data("jsonName"),jsonValue:s.dom.box.data("jsonValue"),jsonSub:s.dom.box.data("jsonSub")}),i=s.dom.box.data("selects"),"string"==typeof i&&i.length&&(s.settings.selects=i.split(",")),r.setOptions(),r.attach(),s.settings.url||s.settings.data?t.isArray(s.settings.data)?e.start.call(s,s.settings.data):"string"==typeof s.settings.url&&s.settings.url.length&&t.getJSON(s.settings.url,function(t){e.start.call(s,t)}):e.start.apply(s))},e.setOptions=function(a){var n,s,i,r=this;if(a&&t.extend(r.settings,a),(!t.isArray(r.selectArray)||!r.selectArray.length||a&&a.selects)&&(r.selectArray=[],t.isArray(r.settings.selects)&&r.settings.selects.length))for(s=0,i=r.settings.selects.length;i>s&&(n=r.dom.box.find("select."+r.settings.selects[s]),n&&n.length);s++)r.selectArray.push(n);a&&(!t.isArray(a.data)&&"string"==typeof a.url&&a.url.length?t.getJSON(r.settings.url,function(t){e.start.call(r,t)}):e.start.call(r,a.data))},e.attach=function(){var t=this;t.attachStatus||t.dom.box.on("change","select",t.changeEvent),"boolean"==typeof t.attachStatus&&e.start.call(t),t.attachStatus=!0},e.detach=function(){var t=this;t.dom.box.off("change","select",t.changeEvent),t.attachStatus=!1},e.clear=function(t){var e,a,n=this,s={display:"",visibility:""};for(t=isNaN(t)?0:t,e=t,a=n.selectArray.length;a>e;e++)n.selectArray[e].empty().prop("disabled",!0),"none"===n.settings.emptyStyle?s.display="none":"hidden"===n.settings.emptyStyle&&(s.visibility="hidden"),n.selectArray[e].css(s)},e.start=function(a){var n,s,i=this;if(t.isArray(a)&&(i.settings.data=e.getData(a,i.settings.jsonSpace)),i.selectArray.length){for(n=0,s=i.selectArray.length;s>n;n++)"string"!=typeof i.selectArray[n].attr("data-value")&&i.selectArray[n][0].options.length&&i.selectArray[n].attr("data-value",i.selectArray[n].val());i.settings.data||"string"==typeof i.selectArray[0].data("url")&&i.selectArray[0].data("url").length?e.getOptionData.call(i,0):i.selectArray[0].prop("disabled",!1).css({display:"",visibility:""})}},e.getOptionData=function(a){var n,s,i,r,l,o,c,d,f,u,g,y=this;if(!("number"!=typeof a||isNaN(a)||0>a||a>=y.selectArray.length))if(n=y.selectArray[a],r=n.data("url"),l="undefined"==typeof n.data("jsonSpace")?y.settings.jsonSpace:n.data("jsonSpace"),o={},e.clear.call(y,a),"string"==typeof r&&r.length){if(a>0)for(u=0,g=1;a>u;u++,g++)c=y.selectArray[g].data("queryName"),d=y.selectArray[u].attr("name"),f=y.selectArray[u].val(),"string"==typeof c&&c.length?o[c]=f:"string"==typeof d&&d.length&&(o[d]=f);t.getJSON(r,o,function(t){s=e.getData(t,l),e.buildOption.call(y,a,s)})}else if(y.settings.data&&"object"==typeof y.settings.data){for(s=y.settings.data,u=0;a>u;u++){if(i=e.getIndex(y.selectArray[u][0].selectedIndex,"boolean"==typeof y.selectArray[u].data("required")?y.selectArray[u].data("required"):y.settings.required),"object"!=typeof s[i]||!t.isArray(s[i][y.settings.jsonSub])||!s[i][y.settings.jsonSub].length){s=null;break}s=s[i][y.settings.jsonSub]}e.buildOption.call(y,a,s)}},e.buildOption=function(e,a){var n,s,i,r=this,l=r.selectArray[e],o="boolean"==typeof l.data("required")?l.data("required"):r.settings.required,c="undefined"==typeof l.data("firstTitle")?r.settings.firstTitle:l.data("firstTitle"),d="undefined"==typeof l.data("firstValue")?r.settings.firstValue:l.data("firstValue"),f="undefined"==typeof l.data("jsonName")?r.settings.jsonName:l.data("jsonName"),u="undefined"==typeof l.data("jsonValue")?r.settings.jsonValue:l.data("jsonValue");if(t.isArray(a)){if(n=o?"":'<option value="'+String(d)+'">'+String(c)+"</option>","string"==typeof f&&f.length)for("string"==typeof u&&u.length||(u=f),s=0,i=a.length;i>s;s++)n+='<option value="'+String(a[s][u])+'">'+String(a[s][f])+"</option>";else for(s=0,i=a.length;i>s;s++)n+='<option value="'+String(a[s])+'">'+String(a[s])+"</option>";l.html(n).prop("disabled",!1).css({display:"",visibility:""}),"string"==typeof l.attr("data-value")&&(l.val(String(l.attr("data-value"))).removeAttr("data-value"),l[0].selectedIndex<0&&(l[0].options[0].selected=!0)),(o||l[0].selectedIndex>0)&&l.trigger("change")}},e.selectChange=function(t){var a,n,s,i=this;if("string"==typeof t&&t.length){for(t=t.replace(/\s+/g,","),t=","+t+",",n=0,s=i.selectArray.length;s>n;n++)if(t.indexOf(","+i.settings.selects[n]+",")>-1){a=n;break}"number"==typeof a&&a>-1&&(a+=1,e.getOptionData.call(i,a))}},t.cxSelect=function(){return e.apply(this,arguments)},t.cxSelect.defaults={selects:[],url:null,data:null,emptyStyle:null,required:!1,firstTitle:"请选择",firstValue:"",jsonSpace:"",jsonName:"n",jsonValue:"",jsonSub:"s"},t.fn.cxSelect=function(e,a){return this.each(function(){t.cxSelect(this,e,a)}),this}});